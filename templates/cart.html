{% extends "layout.html" %}
{% block title %}Cart - Flask Shop{% endblock %}

{% block content %}
<h1 class="mb-4">カート</h1>

{% if lines|length == 0 %}
  <p>カートは空です。</p>
  <a class="btn btn-secondary" href="{{ url_for('products') }}">商品を見に行く</a>
{% else %}
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>商品</th><th>数量</th><th>単価</th><th>小計</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for row in lines %}
        <tr>
          <td class="d-flex align-items-center gap-3">
            <img src="{{ row.product.image_url }}" alt="{{ row.product.name }}" width="64" height="64" class="rounded">
            <div>{{ row.product.name }}</div>
          </td>
          <td style="max-width:160px">
            <form class="d-flex gap-2" action="{{ url_for('cart_update', pid=row.product.id) }}" method="post">
              <input class="form-control" type="number" name="qty" value="{{ row.qty }}" min="0">
              <button class="btn btn-outline-primary" type="submit">更新</button>
            </form>
            <div class="form-text">0 にすると削除</div>
          </td>
          <td>{{ (row.product.price_cents // 100) | int }} 円</td>
          <td>{{ (row.subtotal // 100) | int }} 円</td>
          <td>
            <form action="{{ url_for('cart_update', pid=row.product.id) }}" method="post">
              <input type="hidden" name="qty" value="0">
              <button class="btn btn-sm btn-outline-danger" type="submit">削除</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" class="text-end">合計</th>
          <th colspan="2">{{ (total // 100) | int }} 円</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="d-flex gap-2">
    <form action="{{ url_for('cart_clear') }}" method="post">
      <button class="btn btn-outline-secondary" type="submit">カートを空にする</button>
    </form>
    <form action="{{ url_for('checkout') }}" method="post" class="ms-auto">
      <button class="btn btn-warning" type="submit">チェックアウトへ</button>
    </form>
  </div>
{% endif %}
{% endblock %}